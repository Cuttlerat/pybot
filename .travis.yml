---
sudo: required
language: python
dist: trusty

install:
  - >
    curl -sSL "https://get.docker.com/gpg" |
     sudo -E apt-key add -
  - >
    echo "deb https://apt.dockerproject.org/repo ubuntu-trusty main" |
     sudo tee -a /etc/apt/sources.list
  - sudo apt-get update
  - >
    sudo apt-get -o Dpkg::Options::="--force-confdef" \
     -o Dpkg::Options::="--force-confold" --assume-yes install --allow-unauthenticated docker-engine
  - docker version
  - sudo pip install docker-compose
  - docker-compose version
  - mkdir ./tokens
  - mv .travis.tokens.py ./tokens/tokens.py
  - echo "BOT_TOKEN = '${BOT_TOKEN}'" >> ./tokens/tokens.py

before_script:
  - docker login -u="$REGISTRY_USERNAME" -p="$REGISTRY_PASSWORD"

script:
  - docker-compose up --build -d

after_script:
  - docker-compose down
  - echo "$TRAVIS_BRANCH"
  - if [ "$TRAVIS_BRANCH" == "master" ]; then\
    docker tag pybot cuttlerat/pybot;\
    docker push cuttlerat/pybot;\
    curl -X GET "$WEBHOOK";\
    fi

